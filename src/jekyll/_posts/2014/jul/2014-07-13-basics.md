---
layout: default
title: "Basic Commands"
date: 2014-07-13
description:
  There are three basic commands in Rultor that
  automate merging, deploying and releasing
---

There are three main operations you can do with Rultor: merge, deploy
and release. Every call to Rultor starts with its Github account name
followed by a text, which includes a command.

For example, in a pull request that is ready to be merged you post
a new comment saying, literally:

{% highlight text %}
@rultor please check and merge this pull request
{% endhighlight %}

It is important to start a command with `@rultor` and mention `merge`
somewhere in the text. All the rest is ignored. You can achieve
exactly the same by typing just:

{% highlight text %}
@rultor merge
{% endhighlight %}

BTW, by default, only Github project collaborators can talk to Rultor,
although it is [configurable]({% post_url 2014/jul/2014-07-13-reference %}).

## Merge

It is a very good practice, to run your automated after merging
a pull request into `master` branch and right before pushing changes.
This practices is also called a **pre-flight build**.

When you a pull request is ready, ask Rultor to merge it. Rultor will
checkout your `master` branch, merge changes into it, run automated build,
push new version of `master` into your repo.

Don't forget to create [`.rultor.yml`]({% post_url 2014/jul/2014-07-13-reference %})
in the root directory of your repository,
and configure build automation script there, for example:

{% highlight yaml %}
merge:
  script: mvn clean install
{% endhighlight %}

If you don't configure it, Rultor will try to guess
what is your build automation.
If you have `pom.xml` in your root directory &mdash; it is [Maven](http://maven.apache.org/), if you
have `Gemfile` &mdash; it is [Bundler](http://www.bundler.io), etc. We strongly recommend
to configure your script in [`.rultor.yml`]({% post_url 2014/jul/2014-07-13-reference %}).

## Deploy

Deployment is when you place a packaged artifact into your production (or not)
environment in order to make it available for end-users (or testers).
Different systems deploy themselves differently &mdash; Rultor makes it
possible to automate any possible scenario.

All you need to do is to define your deployment scenario in a bash script,
and configure it in [`.rultor.yml`]({% post_url 2014/jul/2014-07-13-reference %}).
For example, this is how we deploy Rultor itself (see our
[`.rultor.yml`](https://github.com/yegor256/rultor/blob/master/.rultor.yml) file):

{% highlight yaml %}
deploy:
  env:
    MAVEN_OPTS: "-XX:MaxPermSize=256m -Xmx1g"
  script:
    - "sudo bundle"
    - "mvn clean deploy -Prultor --settings ../settings.xml"
    - "mvn clean site-deploy -Psite -Prempl --settings ../settings.xml"
{% endhighlight %}

First, we install all Ruby gems, required for Jekyll (this is how
this website is built). Then, we deploy the system to CloudBees. And then,
we deploy the site to Github Pages.

## Release

Release is when you package a stable version of your product and make
it available for everybody in an artifact repository, for example
[Maven Central](http://search.maven.org/) or [RubyGems](http://www.rubygems.org).

Release command automates this for you. This command requires
one argument, through. You should call it like this:

{% highlight text %}
@rultor release, tag=`1.7`
{% endhighlight %}

Then, in your script you get `$tag` environment variable, which will
be set to `1.7`. Your script should change the version of the product to
1.7 and build it. This is how we do it in jcabi
[`rultor.yml`](https://github.com/jcabi/jcabi/blob/master/.rultor.yml),
for example:

{% highlight yaml %}
release:
  script:
    - "mvn versions:set \"-DnewVersion=${tag}\""
    - "git commit -am \"${tag}\""
    - "mvn clean deploy -Pqulice -Psonatype -Pjcabi"
    - "mvn clean site-deploy -Psite -Prempl --settings ../settings.xml"
{% endhighlight %}

We change the version of the product to the one provided in `$tag`,
then we commit the changes, build and deploy to Sonatype. Then,
we build project site and deploy it to Github Pages.

All the rest will be done by Rultor. Basically, this is what will be done:

 1. Checkout your repository
 2. Run the script configured in `.rultor.yml`
 3. Tag latest commit as `$tag`
 4. Push this new tag to the repository

Of course, if any of these steps fails, the entire command fails
and you get a full log in Github issue.
